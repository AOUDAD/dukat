plugins {
  id("java")
  id("kotlin")
}

sourceSets {
  main.java.srcDirs = ['src']
  main.kotlin.srcDirs = ['src']
}

configurations {
  cliRuntime
  downloadable
}


dependencies {
  implementation(project(":ast"))
  implementation(project(":ast-common"))
  implementation(project(":ast-model"))
  implementation(project(":tsmodel"))
  implementation(project(":translator"))
  implementation(project(":translator-string"))
  implementation(project(":compiler"))

  cliRuntime(project(":compiler"))

  downloadable("org.graalvm.js:js:${gradle.graalVersion}")
}

task updateGraalJs(type: Copy) {
  from configurations.downloadable
  into "${project.projectDir}/libs"
  include "js-${gradle.graalVersion}.jar"
}

jar {
  archiveName = "${project.name}-all.jar"
  manifest {
    attributes 'Main-Class': 'org.jetbrains.dukat.cli.CliKt'
  }


  from {
    configurations.cliRuntime.collect { it.isDirectory() ? it : zipTree(it) }
  }

}